const translations={ro:{title:"ðŸ’µ Curs Valutar Moldova",footer_copyright:"Â© 2026 Curs Valutar. Datele sunt aproximative È™i au scop informativ.",disc_text:"AceastÄƒ aplicaÈ›ie oferÄƒ informaÈ›ii cu titlu informativ, folosind date publice È™i oficiale (inclusiv BNM). Autorii nu Ã®È™i asumÄƒ rÄƒspunderea pentru erori sau pierderi.",subtitle:"Calculator rapid È™i simplu pentru toate valutele",tab_calculator:"ðŸ§® Calculator",tab_comparison:"ðŸ“Š Tabel Comparativ",label_bank:"Bank / SursÄƒ",btn_buy:"CumpÄƒr",btn_sell:"VÃ¢nd",label_amount:"SumÄƒ",label_from:"Din",label_to:"ÃŽn",label_result:"Rezultat:",btn_add_history:"+ AdaugÄƒ Ã®n istoric",header_history:"Istoric Recente",btn_clear_history:"È˜terge tot",header_available_rates:"Cursuri Valutare Disponibile",col_currency:"Valuta",col_buy:"CumpÄƒrare",col_sell:"VÃ¢nzare",header_comparison:"Comparare Cursuri BÄƒnci",label_4th_currency:"A 4-a valutÄƒ:",col_bank:"Banca",col_buy_short:"Cump",col_sell_short:"VÃ¢nz",legend_best_rate:"Cel mai bun curs",loading:"Se Ã®ncarcÄƒ...",update_time:"Actualizat: ",error_fetch:"Eroare la Ã®ncÄƒrcarea datelor.",bank_bnm:"BNM - Banca NaÈ›ionalÄƒ",currency_names:{mdl:"MDL - Leu Moldovenesc",eur:"EUR - Euro",usd:"USD - Dolar SUA",ron:"RON - Leu RomÃ¢nesc",rub:"RUB - Rubla RuseascÄƒ",gbp:"GBP - Lira SterlinÄƒ",uah:"UAH - Hrivna UcraineanÄƒ",chf:"CHF - Franc ElveÈ›ian",cad:"CAD - Dolar Canadian",try:"TRY - Lira TurceascÄƒ",ils:"ILS - Shekel Israelian"},available_only_at_bnm:"Doar BNM",copy_success:"Copiat!",rate_date_bnm:"Curs oficial BNM din data:",rate_date_other:"Curs {0} din data:"},ru:{title:"ðŸ’µ ÐšÑƒÑ€Ñ Ð’Ð°Ð»ÑŽÑ‚ ÐœÐ¾Ð»Ð´Ð¾Ð²Ð°",footer_copyright:"Â© 2026 Curs Valutar. Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ²Ð»ÑÑŽÑ‚ÑÑ Ð¿Ñ€Ð¸Ð±Ð»Ð¸Ð·Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¸ Ð½Ð¾ÑÑÑ‚ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ð¹ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€.",disc_text:"ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð² Ð¾Ð·Ð½Ð°ÐºÐ¾Ð¼Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ†ÐµÐ»ÑÑ…, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð¸ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ BNM). ÐÐ²Ñ‚Ð¾Ñ€Ñ‹ Ð½Ðµ Ð½ÐµÑÑƒÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð·Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð¸Ð»Ð¸ ÑƒÐ±Ñ‹Ñ‚ÐºÐ¸.",subtitle:"Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ ÐºÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€ Ð²Ð°Ð»ÑŽÑ‚",tab_calculator:"ðŸ§® ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€",tab_comparison:"ðŸ“Š Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ",label_bank:"Ð‘Ð°Ð½Ðº / Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº",btn_buy:"ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ",btn_sell:"ÐŸÑ€Ð¾Ð´Ð°Ñ‚ÑŒ",label_amount:"Ð¡ÑƒÐ¼Ð¼Ð°",label_from:"Ð˜Ð·",label_to:"Ð’",label_result:"Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:",btn_add_history:"+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ",header_history:"Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ",btn_clear_history:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÑ‘",header_available_rates:"Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÑƒÑ€ÑÑ‹",col_currency:"Ð’Ð°Ð»ÑŽÑ‚Ð°",col_buy:"ÐŸÐ¾ÐºÑƒÐ¿ÐºÐ°",col_sell:"ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð°",header_comparison:"Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÐšÑƒÑ€ÑÐ¾Ð² Ð‘Ð°Ð½ÐºÐ¾Ð²",label_4th_currency:"4-Ñ Ð²Ð°Ð»ÑŽÑ‚Ð°:",col_bank:"Ð‘Ð°Ð½Ðº",col_buy_short:"ÐŸÐ¾ÐºÑƒÐ¿",col_sell_short:"ÐŸÑ€Ð¾Ð´",legend_best_rate:"Ð›ÑƒÑ‡ÑˆÐ¸Ð¹ ÐºÑƒÑ€Ñ",loading:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...",update_time:"ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾: ",error_fetch:"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….",bank_bnm:"BNM - ÐÐ°Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð‘Ð°Ð½Ðº",currency_names:{mdl:"MDL - ÐœÐ¾Ð»Ð´Ð°Ð²ÑÐºÐ¸Ð¹ Ð›ÐµÐ¹",eur:"EUR - Ð•Ð²Ñ€Ð¾",usd:"USD - Ð”Ð¾Ð»Ð»Ð°Ñ€ Ð¡Ð¨Ð",ron:"RON - Ð ÑƒÐ¼Ñ‹Ð½ÑÐºÐ¸Ð¹ Ð›ÐµÐ¹",rub:"RUB - Ð Ð¾ÑÑÐ¸Ð¹ÑÐºÐ¸Ð¹ Ð ÑƒÐ±Ð»ÑŒ",gbp:"GBP - Ð¤ÑƒÐ½Ñ‚ Ð¡Ñ‚ÐµÑ€Ð»Ð¸Ð½Ð³Ð¾Ð²",uah:"UAH - Ð£ÐºÑ€Ð°Ð¸Ð½ÑÐºÐ°Ñ Ð“Ñ€Ð¸Ð²Ð½Ð°",chf:"CHF - Ð¨Ð²ÐµÐ¹Ñ†Ð°Ñ€ÑÐºÐ¸Ð¹ Ð¤Ñ€Ð°Ð½Ðº",cad:"CAD - ÐšÐ°Ð½Ð°Ð´ÑÐºÐ¸Ð¹ Ð”Ð¾Ð»Ð»Ð°Ñ€",try:"TRY - Ð¢ÑƒÑ€ÐµÑ†ÐºÐ°Ñ Ð›Ð¸Ñ€Ð°",ils:"ILS - Ð˜Ð·Ñ€Ð°Ð¸Ð»ÑŒÑÐºÐ¸Ð¹ Ð¨ÐµÐºÐµÐ»ÑŒ"},available_only_at_bnm:"Ð¢Ð¾Ð»ÑŒÐºÐ¾ BNM",copy_success:"Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾!",rate_date_bnm:"ÐžÑ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÑƒÑ€Ñ BNM Ð½Ð°:",rate_date_other:"ÐšÑƒÑ€Ñ {0} Ð½Ð°:"}};let curLang=localStorage.getItem('lang')||'ro';let ratesData=null;let currentBank="bnm";let transactionMode="buy";let conversionHistory=JSON.parse(localStorage.getItem('currencyHistory'))||[];let currentSort={key:'name',type:'name',order:'asc'};document.addEventListener('DOMContentLoaded',()=>{initLanguage();fetchRates();setupEventListeners();setupSortListeners();renderHistory();});function initLanguage(){updateLanguage(curLang);document.querySelectorAll('.lang-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{const lang=e.target.dataset.lang;if(lang&&lang!==curLang){curLang=lang;localStorage.setItem('lang',lang);updateLanguage(lang);if(ratesData){initApp();}}});});}function updateLanguage(lang){document.querySelectorAll('.lang-btn').forEach(btn=>{btn.classList.toggle('active',btn.dataset.lang===lang);});document.querySelectorAll('[data-i18n]').forEach(el=>{const key=el.dataset.i18n;if(translations[lang]&&translations[lang][key]){el.textContent=translations[lang][key];}else if(translations['ro'][key]){el.textContent=translations['ro'][key];}});const roContent=document.querySelector('.lang-content-ro');const ruContent=document.querySelector('.lang-content-ru');if(roContent&&ruContent){if(lang==='ru'){roContent.style.display='none';ruContent.style.display='block';}else{roContent.style.display='block';ruContent.style.display='none';}}}function t(key){return(translations[curLang]&&translations[curLang][key])? translations[curLang][key]:(translations['ro'][key]||key);}function tCurrency(code){const codeLower=code.toLowerCase();const names=translations[curLang] ? translations[curLang].currency_names:translations['ro'].currency_names;return names[codeLower] ? names[codeLower]:`${code.toUpperCase()} - ${code.toUpperCase()}`;}async function fetchRates(){try{const response=await fetch('rates.json?v='+new Date().getTime());if(!response.ok)throw new Error("Network response was not ok");ratesData=await response.json();const date=ratesData.date;const timeLabel=t('update_time');document.getElementById('last-updated').textContent=`${timeLabel} ${date}`;initApp();}catch(error){console.error("Fetch error:",error);document.getElementById('last-updated').textContent=t('error_fetch');document.getElementById('result-value').textContent="Err";}}function initApp(){renderBankOptions();populateCurrencySelects();populateComparisonSelect();renderComparisonTable();updateResult();}function renderBankOptions(){const select=document.getElementById('bank-selector');const currentVal=currentBank;select.innerHTML='';const bnmOption=document.createElement('option');bnmOption.value='bnm';bnmOption.textContent=t('bank_bnm');select.appendChild(bnmOption);if(ratesData&&ratesData.sources){const banks=Object.keys(ratesData.sources).filter(k=>k!=='bnm');banks.sort();banks.forEach(bankKey=>{const bank=ratesData.sources[bankKey];const opt=document.createElement('option');opt.value=bankKey;opt.textContent=bank.name;select.appendChild(opt);});if(currentVal&&(currentVal==='bnm'||banks.includes(currentVal))){select.value=currentVal;}else{select.value='bnm';currentBank='bnm';}}toggleTransactionType();}function populateCurrencySelects(){const fromSelect=document.getElementById('from-currency');const toSelect=document.getElementById('to-currency');const currentFrom=fromSelect.value ? fromSelect.value:(fromSelect.options.length>0 ? fromSelect.value:'eur');const currentTo=toSelect.value ? toSelect.value:(toSelect.options.length>0 ? toSelect.value:'mdl');const currencies=new Set(['mdl']);if(ratesData&&ratesData.sources&&ratesData.sources.bnm&&ratesData.sources.bnm.rates){Object.keys(ratesData.sources.bnm.rates).forEach(c=>currencies.add(c));}const sortedCurrencies=Array.from(currencies).sort((a,b)=>{if(a==='mdl')return-1;if(b==='mdl')return 1;const priority=['eur','usd','ron','rub','gbp','uah','chf'];const pA=priority.indexOf(a),pB=priority.indexOf(b);if(pA!==-1&&pB!==-1)return pA-pB;if(pA!==-1)return-1;if(pB!==-1)return 1;return a.localeCompare(b);});const generateOptions=(select,selectedVal)=>{select.innerHTML='';sortedCurrencies.forEach(code=>{const opt=document.createElement('option');opt.value=code;opt.textContent=tCurrency(code);if(code===selectedVal)opt.selected=true;select.appendChild(opt);});if(!currencies.has(selectedVal)){if(select.id==='from-currency')select.value='eur';else select.value='mdl';}};generateOptions(fromSelect,currentFrom);generateOptions(toSelect,currentTo);}function toggleTransactionType(){const container=document.getElementById('transaction-type-container');const bnm=currentBank==='bnm';container.style.display=bnm ? 'none':'block';}function getRate(bankKey,currencyCode,type){if(currencyCode==='mdl')return 1;if(!ratesData||!ratesData.sources)return null;const source=ratesData.sources[bankKey];if(!source||!source.rates||!source.rates[currencyCode])return null;if(bankKey==='bnm')return source.rates[currencyCode];const val=source.rates[currencyCode];if(typeof val==='object')return val[type];return val;}function calculate(){const amount=parseFloat(document.getElementById('amount').value)||0;const from=document.getElementById('from-currency').value;const to=document.getElementById('to-currency').value;const getActiveRate=(coin)=>{if(coin==='mdl')return 1;if(currentBank==='bnm')return getRate('bnm',coin);const bankSide=transactionMode==='buy' ? 'sell':'buy';return getRate(currentBank,coin,bankSide);};let rateFrom=getActiveRate(from);let rateTo=getActiveRate(to);const resDiv=document.getElementById('result-value');const infoDiv=document.getElementById('rate-info');if(!rateFrom||!rateTo){rateFrom=getRate('bnm',from);rateTo=getRate('bnm',to);if(!rateFrom||!rateTo){resDiv.textContent="---";infoDiv.textContent=t('available_only_at_bnm');return;}infoDiv.textContent+=" (BNM fallback)";}const valMDL=amount*rateFrom;const result=valMDL/rateTo;resDiv.textContent=result.toFixed(2)+" "+to.toUpperCase();const exchangeRate=rateFrom/rateTo;infoDiv.textContent=`1 ${from.toUpperCase()} = ${exchangeRate.toFixed(4)} ${to.toUpperCase()}`;}function updateDateLabel(){const lastUpdated=document.getElementById('last-updated');if(!ratesData||!ratesData.date)return;const date=ratesData.date;if(currentBank==='bnm'){lastUpdated.textContent=`${t('rate_date_bnm')} ${date}`;}else{const bankName=ratesData.sources[currentBank] ? ratesData.sources[currentBank].name:currentBank.toUpperCase();let text=t('rate_date_other');text=text.replace('{0}',bankName);lastUpdated.textContent=`${text} ${date}`;}}function updateResult(){calculate();renderBankRatesTable();updateDateLabel();}function populateComparisonSelect(){const select=document.getElementById('comp-currency-select');const current=select.value||'ron';select.innerHTML='';if(!ratesData||!ratesData.sources||!ratesData.sources.bnm)return;const allCurrencies=Object.keys(ratesData.sources.bnm.rates);const exclude=['eur','usd','gbp','mdl'];const available=allCurrencies.filter(c=>!exclude.includes(c)).sort();available.forEach(c=>{const opt=document.createElement('option');opt.value=c;opt.textContent=c.toUpperCase();if(c===current)opt.selected=true;select.appendChild(opt);});if(!available.includes(current)&&available.includes('ron')){select.value='ron';}}function setupSortListeners(){document.querySelectorAll('#comparison-table th[data-sort-key]').forEach(th=>{th.addEventListener('click',()=>{const key=th.dataset.sortKey;const type=th.dataset.sortType||'name';if(currentSort.key===key&&currentSort.type===type){currentSort.order=currentSort.order==='asc' ? 'desc':'asc';}else{currentSort.key=key;currentSort.type=type;currentSort.order='asc';if(type==='buy')currentSort.order='desc';if(type==='sell')currentSort.order='asc';}renderComparisonTable();});});}function renderComparisonTable(){const tbody=document.getElementById('comparison-table-body');const dynamicCode=document.getElementById('comp-currency-select').value;document.getElementById('dynamic-header-label').textContent=dynamicCode.toUpperCase();tbody.innerHTML='';if(!ratesData||!ratesData.sources)return;document.querySelectorAll('#comparison-table th').forEach(th=>{th.classList.remove('sort-active','sort-asc','sort-desc');});const activeHeader=document.querySelector(`#comparison-table th[data-sort-key="${currentSort.key}"][data-sort-type="${currentSort.type}"]`)||document.querySelector(`#comparison-table th[data-sort-key="${currentSort.key}"]`);if(activeHeader){activeHeader.classList.add('sort-active');activeHeader.classList.add(currentSort.order==='asc' ? 'sort-asc':'sort-desc');}let commercialBanks=Object.keys(ratesData.sources).filter(k=>k!=='bnm');const displayCurrencies=['eur','usd','gbp',dynamicCode];const bests={};displayCurrencies.forEach(c=>{bests[c]={buy:-Infinity,sell:Infinity};});commercialBanks.forEach(bankKey=>{const source=ratesData.sources[bankKey];displayCurrencies.forEach(c=>{let buyVal=0,sellVal=0;const r=source.rates[c];if(r&&typeof r==='object'){buyVal=r.buy;sellVal=r.sell;}if(buyVal>bests[c].buy)bests[c].buy=buyVal;if(sellVal>0&&sellVal<bests[c].sell)bests[c].sell=sellVal;});});commercialBanks.sort((aKey,bKey)=>{const sourceA=ratesData.sources[aKey];const sourceB=ratesData.sources[bKey];let valA,valB;if(currentSort.key==='name'){valA=sourceA.name.toLowerCase();valB=sourceB.name.toLowerCase();}else if(currentSort.key==='dynamic'){const curCode=dynamicCode;const type=currentSort.type;const rateA=sourceA.rates[curCode];const rateB=sourceB.rates[curCode];valA=(rateA&&typeof rateA==='object')? rateA[type]:-1;valB=(rateB&&typeof rateB==='object')? rateB[type]:-1;}else{const curCode=currentSort.key;const type=currentSort.type;const rateA=sourceA.rates[curCode];const rateB=sourceB.rates[curCode];valA=(rateA&&typeof rateA==='object')? rateA[type]:-1;valB=(rateB&&typeof rateB==='object')? rateB[type]:-1;}if(valA<valB)return currentSort.order==='asc' ?-1:1;if(valA>valB)return currentSort.order==='asc' ? 1:-1;return 0;});const banks=['bnm',...commercialBanks];banks.forEach(bankKey=>{const source=ratesData.sources[bankKey];const tr=document.createElement('tr');const tdName=document.createElement('td');tdName.textContent=source.name;if(bankKey==='bnm'){tdName.style.fontWeight='bold';tdName.style.color='var(--primary-color)';}tr.appendChild(tdName);displayCurrencies.forEach(c=>{const r=source.rates ? source.rates[c]:null;const tdBuy=document.createElement('td');const tdSell=document.createElement('td');let buyVal=0,sellVal=0;let displayBuy='-',displaySell='-';if(bankKey==='bnm'){if(r){let val=(typeof r==='object')? r.buy:r;buyVal=val;sellVal=val;displayBuy=val.toFixed(4);displaySell=val.toFixed(4);}}else{if(r&&typeof r==='object'){buyVal=r.buy;sellVal=r.sell;displayBuy=r.buy.toFixed(2);displaySell=r.sell.toFixed(2);}}tdBuy.textContent=displayBuy;tdSell.textContent=displaySell;if(bankKey!=='bnm'){if(buyVal>0&&Math.abs(buyVal-bests[c].buy)<0.0001)tdBuy.classList.add('best-rate');if(sellVal>0&&Math.abs(sellVal-bests[c].sell)<0.0001)tdSell.classList.add('best-rate');}tr.appendChild(tdBuy);tr.appendChild(tdSell);});tbody.appendChild(tr);});}function renderBankRatesTable(){const tbody=document.getElementById('rates-table-body');const container=document.getElementById('rates-table-container');tbody.innerHTML='';if(!ratesData||!ratesData.sources)return;const source=ratesData.sources[currentBank];if(!source||!source.rates)return;container.style.display='block';const allCurrencies=Object.keys(source.rates).filter(c=>c!=='mdl');allCurrencies.sort((a,b)=>{const priority=['eur','usd','ron','gbp','rub','uah','chf'];const pA=priority.indexOf(a),pB=priority.indexOf(b);if(pA!==-1&&pB!==-1)return pA-pB;if(pA!==-1)return-1;if(pB!==-1)return 1;return a.localeCompare(b);});allCurrencies.forEach(code=>{const r=source.rates[code];let buyVal='-',sellVal='-';if(currentBank==='bnm'&&r){const val=(typeof r==='object')? r.buy:r;buyVal=val.toFixed(4);sellVal=val.toFixed(4);}else if(r&&typeof r==='object'){buyVal=r.buy.toFixed(2);sellVal=r.sell.toFixed(2);}if(buyVal!=='-'){const tr=document.createElement('tr');tr.innerHTML=`<td><strong>${code.toUpperCase()}</strong></td><td>${buyVal}</td><td>${sellVal}</td>`;tbody.appendChild(tr);}});}function addToHistory(){const amount=document.getElementById('amount').value;const from=document.getElementById('from-currency').value.toUpperCase();const to=document.getElementById('to-currency').value.toUpperCase();const resultText=document.getElementById('result-value').textContent;if(resultText==="---"||resultText==="0.00"||resultText.includes("Err"))return;const newItem={amount,from,to,result:resultText,bank:ratesData.sources[currentBank].name,date:new Date().toLocaleTimeString(curLang==='ro' ? 'ro-RO':'ru-RU',{hour:'2-digit',minute:'2-digit'})};conversionHistory.unshift(newItem);if(conversionHistory.length>10)conversionHistory.pop();localStorage.setItem('currencyHistory',JSON.stringify(conversionHistory));renderHistory();}function renderHistory(){const section=document.getElementById('history-section');const list=document.getElementById('history-list');if(conversionHistory.length===0){section.style.display='none';return;}section.style.display='block';list.innerHTML='';conversionHistory.forEach((item,index)=>{const li=document.createElement('li');li.className='history-item';li.innerHTML=`<div class="history-details"><strong>${item.amount} ${item.from}</strong> âž” <strong>${item.result}</strong> <br><small style="color:#999">${item.date} (${item.bank})</small></div><div class="history-actions"><button class="copy-hist-btn" data-text="${item.result}" title="${t('copy_success')}">ðŸ“‹</button><button class="history-del-btn" data-index="${index}">âœ•</button></div>`;list.appendChild(li);});document.querySelectorAll('.copy-hist-btn').forEach(btn=>{btn.addEventListener('click',async(e)=>{const text=e.target.dataset.text;try{const parts=text.split(' ');const valToCopy=(parts.length>0&&!isNaN(parseFloat(parts[0])))?parts[0]:text;await navigator.clipboard.writeText(valToCopy);const original=e.target.innerHTML;e.target.innerHTML='âœ“';setTimeout(()=>{e.target.innerHTML=original;},1000);}catch(err){console.error('Failed to copy',err);}});});document.querySelectorAll('.history-del-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{const idx=parseInt(e.target.dataset.index);conversionHistory.splice(idx,1);localStorage.setItem('currencyHistory',JSON.stringify(conversionHistory));renderHistory();});});}function setupEventListeners(){document.getElementById('amount').addEventListener('input',updateResult);document.getElementById('bank-selector').addEventListener('change',(e)=>{currentBank=e.target.value;toggleTransactionType();updateResult();});document.getElementById('from-currency').addEventListener('change',updateResult);document.getElementById('to-currency').addEventListener('change',updateResult);document.getElementById('swap-btn').addEventListener('click',()=>{const from=document.getElementById('from-currency');const to=document.getElementById('to-currency');const temp=from.value;from.value=to.value;to.value=temp;updateResult();});const btnBuy=document.getElementById('btn-buy');const btnSell=document.getElementById('btn-sell');btnBuy.addEventListener('click',()=>{transactionMode='buy';btnBuy.classList.add('active');btnSell.classList.remove('active');updateResult();});btnSell.addEventListener('click',()=>{transactionMode='sell';btnSell.classList.add('active');btnBuy.classList.remove('active');updateResult();});document.querySelectorAll('.tab-btn').forEach(btn=>{btn.addEventListener('click',()=>{document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');btn.classList.add('active');const target=btn.dataset.tab;document.getElementById(target).style.display='block';if(target==='comparison-tab'){document.getElementById('calculator-tab').classList.remove('active');document.getElementById('comparison-tab').classList.add('active');renderComparisonTable();}else{document.getElementById('calculator-tab').classList.add('active');document.getElementById('comparison-tab').classList.remove('active');}});});document.getElementById('save-history-btn').addEventListener('click',addToHistory);document.getElementById('clear-history-btn').addEventListener('click',()=>{conversionHistory=[];localStorage.removeItem('currencyHistory');renderHistory();});document.getElementById('comp-currency-select').addEventListener('change',renderComparisonTable);const copyBtn=document.getElementById('copy-result-btn');copyBtn.addEventListener('click',async()=>{const text=document.getElementById('result-value').textContent;try{const parts=text.split(' ');const valToCopy=(parts.length>0&&!isNaN(parseFloat(parts[0])))?parts[0]:text;await navigator.clipboard.writeText(valToCopy);const originalHTML=copyBtn.innerHTML;copyBtn.innerHTML='<span style="color:green">âœ“</span>';setTimeout(()=>{copyBtn.innerHTML=originalHTML;},1000);}catch(e){}});}