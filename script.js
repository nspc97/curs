document.addEventListener('DOMContentLoaded' , () => { const amountInput = document.getElementById('amount' ); const fromSelect = document.getElementById('from-currency' ); const toSelect = document.getElementById('to-currency' ); const resultValue = document.getElementById('result-value' ); const rateInfo = document.getElementById('rate-info' ); const lastUpdated = document.getElementById('last-updated' ); const swapBtn = document.getElementById('swap-btn' ); const copyBtn = document.getElementById('copy-result-btn' ); const saveHistoryBtn = document.getElementById('save-history-btn' ); const historySection = document.getElementById('history-section' ); const historyList = document.getElementById('history-list' ); const clearHistoryBtn = document.getElementById('clear-history-btn' ); const bankSelect = document.getElementById('bank-selector' ); const transactionTypeContainer = document.getElementById('transaction-type-container' ); const btnBuy = document.getElementById('btn-buy' ); const btnSell = document.getElementById('btn-sell' ); let exchangeData = null; let conversionHistory = JSON.parse(localStorage.getItem('currencyHistory' )) || []; let currentTransactionType ='buy' ;  const CURRENCY_NAMES = {'mdl' :'Leu Moldovenesc' ,'eur' :'Euro' ,'usd' :'Dolar SUA' ,'ron' :'Leu RomÃ¢nesc' ,'rub' :'Rubla RuseascÄƒ' ,'gbp' :'Lira SterlinÄƒ' ,'uah' :'Hrivna UcraineanÄƒ' ,'chf' :'Franc ElveÈ›ian' ,'cad' :'Dolar Canadian' ,'try' :'Lira TurceascÄƒ' ,'ils' :'Shekel Israelian' ,'sek' :'Coroana SuedezÄƒ' ,'dkk' :'Coroana DanezÄƒ' ,'nok' :'Coroana NorvegianÄƒ' ,'huf' :'Forint Maghiar' ,'aud' :'Dolar Australian' ,'czk' :'Coroana CehÄƒ' ,'pln' :'Zlot Polonez' ,'bgn' :'Leva BulgÄƒreascÄƒ' ,'jpy' :'Yen Japonez' ,'gel' :'Lari Georgian' ,'aed' :'Dirham EAU' ,'all' :'Lek Albanez' ,'amd' :'Dram Armenesc' ,'azn' :'Manat Azer' ,'byn' :'Rubla BelarusÄƒ' ,'cny' :'Yuan Renminbi Chinezesc' ,'hkd' :'Dolar Hong Kong' ,'inr' :'Rupia IndianÄƒ' ,'isk' :'Coroana IslandezÄƒ' ,'kgs' :'Som KÃ¢rgÃ¢z' ,'krw' :'Won Sud-Coreean' ,'kwd' :'Dinar Kuweitian' ,'kzt' :'Tenge Kazah' ,'mkd' :'Denar Macedonean' ,'myr' :'Ringgit Malaezian' ,'nzd' :'Dolar Neo-Zeelandez' ,'rsd' :'Dinar SÃ¢rbesc' ,'tjs' :'Somoni Tadjic' ,'tmt' :'Manat Turkmen' ,'uzs' :'Sum Uzbec' ,'xdr' :'Drepturi Speciale de Tragere' }; function getCurrencyName(code) { return CURRENCY_NAMES[code] || code.toUpperCase(); } const tabBtns = document.querySelectorAll('.tab-btn' ); const tabContents = document.querySelectorAll('.tab-content' ); tabBtns.forEach(btn => { btn.addEventListener('click' , () => { tabBtns.forEach(b => b.classList.remove('active' )); tabContents.forEach(c => c.style.display ='none' ); btn.classList.add('active' ); const targetId = btn.getAttribute('data-tab' ); const targetContent = document.getElementById(targetId); if (targetContent) { targetContent.style.display ='block' ; if (targetId ==='comparison-tab' ) { renderComparisonTable(); } } }); }); const comparisonSelect = document.getElementById('comp-currency-select' ); if (comparisonSelect) { comparisonSelect.addEventListener('change' , () => { renderComparisonTable(); }); } function populateComparisonSelect() { if (!exchangeData || !exchangeData.sources['bnm' ]) return; const bnmRates = exchangeData.sources['bnm' ].rates; const currencies = Object.keys(bnmRates).sort(); comparisonSelect.innerHTML ='' ; const exclude = ['mdl' ,'eur' ,'usd' ,'gbp' ]; currencies.forEach(code => { if (exclude.includes(code)) return; const opt = document.createElement('option' ); opt.value = code; opt.textContent =`${code.toUpperCase()} - ${getCurrencyName(code)}` ; if (code ==='ron' ) opt.selected = true; comparisonSelect.appendChild(opt); }); } function renderComparisonTable() { const tbody = document.getElementById('comparison-table-body' ); const dynHeader = document.getElementById('dynamic-header-label' ); if (!tbody || !exchangeData) return; const dynCurrency = comparisonSelect.value ||'ron' ; dynHeader.textContent = dynCurrency.toUpperCase(); tbody.innerHTML ='' ;  const bestRates = { eur: { buy: -1, sell: 99999 }, usd: { buy: -1, sell: 99999 }, gbp: { buy: -1, sell: 99999 }, dynamic: { buy: -1, sell: 99999 } }; for (const [key, source] of Object.entries(exchangeData.sources)) { if (key ==='bnm' ) continue;  const check = (code, typeKey) => { if (source.rates[code] && typeof source.rates[code] ==='object' ) { const r = source.rates[code]; if (r.buy > bestRates[typeKey].buy) bestRates[typeKey].buy = r.buy; if (r.sell > 0 && r.sell < bestRates[typeKey].sell) bestRates[typeKey].sell = r.sell; } }; check('eur' ,'eur' ); check('usd' ,'usd' ); check('gbp' ,'gbp' ); check(dynCurrency,'dynamic' ); } for (const [key, source] of Object.entries(exchangeData.sources)) {  const tr = document.createElement('tr' ); const nameTd = document.createElement('td' ); nameTd.innerHTML =`<strong>${source.name || key.toUpperCase()}</strong>` ; tr.appendChild(nameTd); const createCell = (code, typeKey) => { let buyStr ='-' , sellStr ='-' ; let isBestBuy = false, isBestSell = false; if (key ==='bnm' ) { if (source.rates[code]) { const val = source.rates[code].toFixed(4); buyStr = val; sellStr = val; } } else { if (source.rates[code] && typeof source.rates[code] ==='object' ) { const r = source.rates[code]; if (r.buy > 0) { buyStr = r.buy.toFixed(2); if (r.buy === bestRates[typeKey].buy) isBestBuy = true; } if (r.sell > 0) { sellStr = r.sell.toFixed(2); if (r.sell === bestRates[typeKey].sell) isBestSell = true; } } } const buyTd = document.createElement('td' ); buyTd.textContent = buyStr; if (isBestBuy) buyTd.className ='best-rate' ; const sellTd = document.createElement('td' ); sellTd.textContent = sellStr; if (isBestSell) sellTd.className ='best-rate' ; tr.appendChild(buyTd); tr.appendChild(sellTd); }; createCell('eur' ,'eur' ); createCell('usd' ,'usd' ); createCell('gbp' ,'gbp' ); createCell(dynCurrency,'dynamic' ); tbody.appendChild(tr); } } async function loadRates() { try { const response = await fetch('rates.json?v=' + new Date().getTime()); if (!response.ok) throw new Error('Nu am putut Ã®ncÄƒrca ratele' ); exchangeData = await response.json(); populateBankSelector(); populateComparisonSelect(); updateUIForCurrentBank(); calculate(); renderHistory(); } catch (error) { console.error('Eroare la Ã®ncÄƒrcarea cursurilor:' , error); resultValue.textContent ="Eroare" ; rateInfo.textContent ="Se Ã®ncarcÄƒ cursurile..." ; } } bankSelect.addEventListener('change' , () => { updateUIForCurrentBank(); calculate(); }); function updateUIForCurrentBank() { const bankKey = bankSelect.value; const source = exchangeData.sources[bankKey]; populateCurrencySelects(source); renderRatesTable(bankKey, source); updateDateLabel(bankKey); const isCommercial = bankKey !=='bnm' ; transactionTypeContainer.style.display = isCommercial ?'block' :'none' ; } function populateCurrencySelects(source) { if (!source || !source.rates) return; const availableCurrencies = new Set(['mdl' ]); Object.keys(source.rates).forEach(k => availableCurrencies.add(k)); const currentFrom = fromSelect.value; const currentTo = toSelect.value; const refill = (selectElement, selectedValue) => { selectElement.innerHTML ='' ; const sorted = Array.from(availableCurrencies).sort((a, b) => { if (a ==='mdl' ) return -1; if (b ==='mdl' ) return 1; const majors = ['eur' ,'usd' ,'ron' ,'rub' ,'gbp' ,'uah' ]; const idxA = majors.indexOf(a); const idxB = majors.indexOf(b); if (idxA !== -1 && idxB !== -1) return idxA - idxB; if (idxA !== -1) return -1; if (idxB !== -1) return 1; return a.localeCompare(b); }); sorted.forEach(code => { const opt = document.createElement('option' ); opt.value = code; opt.textContent =`${code.toUpperCase()} - ${getCurrencyName(code)}` ; selectElement.appendChild(opt); }); if (availableCurrencies.has(selectedValue)) { selectElement.value = selectedValue; } else { if (selectElement.id ==='from-currency' ) selectElement.value = availableCurrencies.has('eur' ) ?'eur' :'mdl' ; if (selectElement.id ==='to-currency' ) selectElement.value ='mdl' ; } }; refill(fromSelect, currentFrom); refill(toSelect, currentTo); } function renderRatesTable(bankKey, source) { const container = document.getElementById('rates-table-container' ); const tbody = document.getElementById('rates-table-body' ); if (!container || !tbody) return; container.style.display ='block' ; tbody.innerHTML ='' ; if (!source || !source.rates) return; const isBNM = bankKey ==='bnm' ; const currencies = Object.keys(source.rates).sort((a, b) => { const majors = ['eur' ,'usd' ,'ron' ,'rub' ,'gbp' ,'uah' ]; const idxA = majors.indexOf(a); const idxB = majors.indexOf(b); if (idxA !== -1 && idxB !== -1) return idxA - idxB; if (idxA !== -1) return -1; if (idxB !== -1) return 1; return a.localeCompare(b); }); currencies.forEach(code => { if (code ==='mdl' ) return; const tr = document.createElement('tr' ); const nameCell =`<td><strong>${code.toUpperCase()}</strong> <small style="color:#888; display:block; font-size:0.8em">${getCurrencyName(code)}</small></td>` ; let buyCell ='-' , sellCell ='-' ; if (isBNM) { const val = source.rates[code];        buyCell = val.toFixed(4); sellCell = val.toFixed(4); } else { const rateObj = source.rates[code]; if (rateObj && typeof rateObj ==='object' ) { buyCell = rateObj.buy > 0 ? rateObj.buy.toFixed(2) :'-' ; sellCell = rateObj.sell > 0 ? rateObj.sell.toFixed(2) :'-' ; } } tr.innerHTML =`${nameCell}<td>${buyCell}</td><td>${sellCell}</td>` ; tbody.appendChild(tr); }); } function updateDateLabel(bankKey) { if (exchangeData.date) { const date = exchangeData.date; const sourceName = exchangeData.sources[bankKey].name || bankKey.toUpperCase(); if (bankKey ==='bnm' ) { lastUpdated.innerHTML =`Curs oficial BNM din data: <span style="color:#2c3e50; font-weight:900;">${date}</span>` ; } else { lastUpdated.innerHTML =`Curs <strong>${sourceName}</strong> din data: <span style="color:#2c3e50; font-weight:900;">${date}</span>` ; } } } function populateBankSelector() { if (!exchangeData || !exchangeData.sources) return; bankSelect.innerHTML ='' ; if (exchangeData.sources['bnm' ]) { const option = document.createElement('option' ); option.value ='bnm' ; option.textContent = exchangeData.sources['bnm' ].name ||'Banca NaÈ›ionalÄƒ (BNM)' ; bankSelect.appendChild(option); } for (const [key, source] of Object.entries(exchangeData.sources)) { if (key ==='bnm' ) continue; const option = document.createElement('option' ); option.value = key; option.textContent = source.name || key.toUpperCase(); bankSelect.appendChild(option); } } function getRate(currency, sourceKey, type) { if (currency ==='mdl' ) return 1.0; const source = exchangeData.sources[sourceKey]; if (!source || !source.rates || !source.rates[currency]) return null; const rateObj = source.rates[currency]; if (typeof rateObj ==='number' ) { return rateObj; } if (typeof rateObj ==='object' ) { if (type ==='buy' ) return rateObj.buy; if (type ==='sell' ) return rateObj.sell; } return null; } function calculate() { if (!exchangeData) return; const amount = parseFloat(amountInput.value); const from = fromSelect.value; const to = toSelect.value; const bankKey = bankSelect.value; const isCommercial = bankKey !=='bnm' ; transactionTypeContainer.style.display = isCommercial ?'block' :'none' ;  if (exchangeData.date) { } if (isNaN(amount)) { resultValue.textContent ="0.00" ; return; } let rateFrom, rateTo; if (isCommercial) {  rateFrom = getRate(from, bankKey, currentTransactionType); rateTo = getRate(to, bankKey, currentTransactionType); } else { const bnmSource = exchangeData.sources['bnm' ]; if (!bnmSource) return; rateFrom = from ==='mdl' ? 1.0 : bnmSource.rates[from]; rateTo = to ==='mdl' ? 1.0 : bnmSource.rates[to]; } if (!rateFrom || !rateTo) { resultValue.textContent ="---" ; rateInfo.textContent ="Curs indisponibil pt aceastÄƒ pereche la aceastÄƒ bancÄƒ" ; return; } const amountInMDL = amount * rateFrom; const result = amountInMDL / rateTo; resultValue.style.opacity ='1' ; const formattedResult = result.toFixed(2); resultValue.textContent =`${formattedResult} ${to.toUpperCase()}` ; const exchangeRate = rateFrom / rateTo; rateInfo.textContent =`1 ${from.toUpperCase()} = ${exchangeRate.toFixed(4)} ${to.toUpperCase()}` ; } function renderHistory() { if (conversionHistory.length === 0) { historySection.style.display ='none' ; return; } historySection.style.display ='block' ; historyList.innerHTML ='' ; conversionHistory.forEach((item, index) => { const li = document.createElement('li' ); li.className ='history-item' ; li.innerHTML =`
                <div class="history-details">
                    <strong>${item.amount} ${item.from}</strong> âž” <strong>${item.result} ${item.to}</strong>
                    <br><small style="color:#999">${item.date} (${item.bank})</small>
                </div>
                <div class="history-actions">
                    <button class="history-copy-btn" title="CopiazÄƒ valoarea" data-text="${item.result}">
                         ðŸ“‹
                    </button>
                    <button class="history-del-btn" title="È˜terge" data-index="${index}">
                         âœ•
                    </button>
                </div>
            ` ; historyList.appendChild(li); }); document.querySelectorAll('.history-copy-btn' ).forEach(btn => { btn.addEventListener('click' , (e) => { const text = e.target.closest('button' ).dataset.text; copyToClipboard(text); }); }); document.querySelectorAll('.history-del-btn' ).forEach(btn => { btn.addEventListener('click' , (e) => { const index = parseInt(e.target.closest('button' ).dataset.index); deleteHistoryItem(index); }); }); } function addToHistory() { if (!exchangeData) return; const amount = amountInput.value; const from = fromSelect.value.toUpperCase(); const to = toSelect.value.toUpperCase(); const bankKey = bankSelect.value; const resultText = resultValue.textContent.split(' ' )[0]; if (resultText ==="---" || resultText ==="0.00" || resultText ==="Eroare" ) return; let bankName ="BNM" ; if (exchangeData.sources && exchangeData.sources[bankKey]) { bankName = exchangeData.sources[bankKey].name || bankKey.toUpperCase(); } if (conversionHistory.length > 0) { const last = conversionHistory[0]; if (last.amount === amount && last.from === from && last.to === to && last.bank === bankName) return; } const newItem = { amount: amount, from: from, to: to, result: resultText, bank: bankName, date: new Date().toLocaleTimeString('ro-MD' , { hour:'2-digit' , minute:'2-digit' }) }; conversionHistory.unshift(newItem); if (conversionHistory.length > 10) conversionHistory.pop(); localStorage.setItem('currencyHistory' , JSON.stringify(conversionHistory)); renderHistory(); } function deleteHistoryItem(index) { conversionHistory.splice(index, 1); localStorage.setItem('currencyHistory' , JSON.stringify(conversionHistory)); renderHistory(); } async function copyToClipboard(text) { try { await navigator.clipboard.writeText(text); } catch (err) { console.error('Failed to copy: ' , err); } } function setTransactionType(type) { currentTransactionType = type; if (type ==='buy' ) { btnBuy.classList.add('active' ); btnSell.classList.remove('active' ); } else { btnSell.classList.add('active' ); btnBuy.classList.remove('active' ); } calculate(); } amountInput.addEventListener('input' , calculate); fromSelect.addEventListener('change' , calculate); toSelect.addEventListener('change' , calculate); bankSelect.addEventListener('change' , () => { calculate(); }); btnBuy.addEventListener('click' , () => setTransactionType('buy' )); btnSell.addEventListener('click' , () => setTransactionType('sell' )); swapBtn.addEventListener('click' , () => { const temp = fromSelect.value; fromSelect.value = toSelect.value; toSelect.value = temp; calculate(); }); copyBtn.addEventListener('click' , () => { const textToCopy = resultValue.textContent.split(' ' )[0]; copyToClipboard(textToCopy); const originalHTML = copyBtn.innerHTML; copyBtn.innerHTML ='<span style="color:green">âœ“</span>' ; setTimeout(() => { copyBtn.innerHTML = originalHTML; }, 1000); }); saveHistoryBtn.addEventListener('click' , () => { addToHistory(); }); clearHistoryBtn.addEventListener('click' , () => { conversionHistory = []; localStorage.removeItem('currencyHistory' ); renderHistory(); }); loadRates(); });